---
import type { GetStaticPathsOptions, Page } from "astro"
import { CollectionEntry, getCollection } from "astro:content"
import Pagination from "~/components/Pagination.astro"
import MainLayout from "~/layouts/MainLayout.astro"
import ShowcaseCard from "./_components/ShowcaseCard.astro"
import SubmitSite from "./_components/SubmitSite.astro"

export const prerender = true

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
	// fetch all showcase sites
	const showcase = await getCollection("showcase")

	// sort featured sites to the front, randomize the rest
	const sortedShowcase = showcase.sort(
		(a, b) => (b.data.featured ?? Math.random()) - (a.data.featured ?? Math.random()),
	)

	return paginate(sortedShowcase, { pageSize: 30 })
}

const { page } = Astro.props as { page: Page<CollectionEntry<"showcase">> }
const showcase = page.data

const allPages = [...Array(page.lastPage).keys()].map((num) => {
	return `/showcase${num === 0 ? "" : `/${String(num + 1)}`}`
})

const title = "Showcase"
const description = "Explore what's possible with Astro and get inspired for your next project."
---

<MainLayout
	title={title}
	description={description}
	image={{ src: "/og/showcase.jpg", alt: "Explore the possibilities" }}
>
	<div class="hero relative">
		<div class="grid-container">
			<h1
				class="heading-3 mx-auto max-w-screen-lg pt-24 text-center sm:heading-2 lg:heading-1 md:pt-32 lg:pt-40"
			>
				Explore the infinite possibilities of Astro
			</h1>
		</div>
	</div>

	<div class="backgrounds grid-container relative">
		<ul class="grid gap-5 md:grid-flow-row-dense md:grid-cols-2 lg:grid-cols-3">
			{
				showcase.map((site, i) => (
					<>
						<li class:list={{ "md:col-span-2 md:row-span-2": site.data.highlight }}>
							<ShowcaseCard site={site} />
						</li>
						{i === 5 && (
							<li class="md:col-span-2 lg:col-span-3">
								<SubmitSite />
							</li>
						)}
					</>
				))
			}
		</ul>

		<Pagination restRoute allPages={allPages} page={page} class="mx-auto" />
	</div>
</MainLayout>

<style>
	:global(main::before) {
		@apply absolute w-full aspect-square bg-repeat mask-linear-gradient-to-b z-noise-underlay;
		content: "";
		background-size: 20px 20px;
		background-image: linear-gradient(to right, rgb(35 38 45) 1px, transparent 1px),
			linear-gradient(to bottom, rgb(35 38 45) 1px, transparent 1px);
	}

	.hero::before {
		@apply absolute z-noise-underlay h-[50vw] w-1/2 top-1/2 left-0 -translate-x-1/2 -translate-y-1/3 rounded-3xl blur-xl;
		content: "";
		background: radial-gradient(rgba(149, 79, 243, 0.3), transparent 80%);
	}

	.hero::after {
		@apply absolute z-noise-underlay h-[50vw] w-1/2 top-1/2 right-0 translate-x-1/2 -translate-y-1/3 rounded-3xl blur-xl;
		content: "";
		background: radial-gradient(rgba(59, 144, 188, 0.3), transparent 80%);
	}

	.backgrounds:last-of-type::after {
		@apply absolute blur-xl z-noise-underlay rounded-3xl w-full lg:w-3/4 max-w-screen-xl left-1/2 -translate-x-1/2 aspect-video bottom-0 translate-y-2/3;
		content: "";
		background: radial-gradient(
			rgba(252, 178, 65, 0.7),
			rgba(252, 178, 65, 0.5) 40%,
			transparent 80%
		);
	}
</style>
